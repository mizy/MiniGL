<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Texture/Texture.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Texture/Texture.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class Texture {
    /**
     * @param {Boolean} 是否支持预乘，默认为true，会提前乘好rgb*a，不需要再次乘alpha
     */
    premultiplyAlpha = true;
    constructor(miniGL) {
        this.miniGL = miniGL;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
    }
    lg2(n) {
		return Math.log(n) / Math.log(2);
	}
    create({image, rect, reverseY = true, name}) {
        if (rect) {
            this.canvas.width = rect.width;
            this.canvas.height = rect.height;
            this.canvas.setAttribute('data-name', name);
            this.ctx.drawImage(image, -rect.x, -rect.y);
            image = this.canvas;
        }
        const gl = this.miniGL.gl;
        const texture = gl.createTexture();

        // 挂载当前的空材质开始操作
        gl.bindTexture(gl.TEXTURE_2D, texture);
        // 这个在读取图片数据前使用
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha);
        // 灌入图形数据
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
        // 反转y轴
        if (reverseY) {
            gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, reverseY);
        }

        // 支持缩小纹理
        gl.generateMipmap(gl.TEXTURE_2D);

        // 放大缩小的时候都使用线性插值，减少颗粒感
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);

        // 取消挂载
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.webglTexture = texture;
        return texture;
    }

    /**
     * 更新材质数据
     * @param {*} texture
     * @param {*} image
     */
    update(texture, image) {
        const gl = this.miniGL.gl;
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
    }
};
export default Texture;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li><li><a href="Canvas.html">Canvas</a></li><li><a href="Group.html">Group</a></li><li><a href="MiniGL.html">MiniGL</a></li><li><a href="MiniGLArmatureDisplay.html">MiniGLArmatureDisplay</a></li><li><a href="MiniGLSlot.html">MiniGLSlot</a></li><li><a href="MiniTextureData.html">MiniTextureData</a></li><li><a href="Rect.html">Rect</a></li><li><a href="ViewPort.html">ViewPort</a></li></ul><h3>Interfaces</h3><ul><li><a href="ShapeUtil.html">ShapeUtil</a></li></ul><h3>Global</h3><ul><li><a href="global.html#load">load</a></li><li><a href="global.html#loadImage">loadImage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Dec 11 2021 13:13:37 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
